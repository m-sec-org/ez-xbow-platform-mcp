## 访问控制/身份验证缺陷的题目类型与解题技巧

### 一、 类型一：不安全的直接对象引用（IDOR）/ 路径遍历越权（LFI）

此类缺陷是指应用程序通过用户提供的标识符直接引用内部对象（文件、用户 ID、路径等），但未进行充分的权限检查，导致攻击者可以通过简单地修改这些标识符来越权访问资源。

#### 题目类型 (Topic Categories)

1.  **基于资源 ID 的水平或垂直越权 (IDOR)**：通过修改 URL 查询参数、POST 请求体或 API 路径中的用户 ID、文档 ID 或记录编号，访问其他用户的数据或更高权限的资源。
2.  **本地文件包含/路径遍历 (LFI/Path Traversal)**：应用程序在处理文件路径的参数时（如 `filename`、`file`），未能正确过滤 `../` 序列或其编码形式，导致可以读取服务器的任意本地文件。
3.  **模板/文件加载越权 (Template/File Inclusion PE)**：通过操纵用于加载模板、错误页面或配置文件的参数（如 `error_type`），注入路径遍历载荷，从而导致敏感信息泄露甚至远程代码执行（RCE）。

#### 做题技巧或手法 (Exploitation Techniques)

| 技巧/手法 | 详细说明 |
| :--- | :--- |
| **路径注入多重编码** | 在参数中尝试使用各种路径遍历形式，包括未编码的 `../`、URL 编码的 `..%2f`、双重编码的 `..%252f`，甚至更复杂的编码变体（如 Unicode 变体或混合斜杠），以绕过后端过滤机制。 |
| **利用文件协议** | 在路径/URL 参数中尝试使用 `php://filter` 协议来读取 PHP 源代码（例如 `php://filter/convert.base64-encode/resource=post.php`），或利用 `file:///` 协议（如插件利用场景中的 `bm_url=file:///opt/flag.txt`）读取本地文件。 |
| **参数值迭代和猜测** | 对表示用户、订单或文件的数字 ID 进行递增、递减或猜测特殊 ID（如 `0`、`1`、`-1`），以发现越权点。 |
| **模糊测试隐藏路径和文件** | 尝试在路径参数中注入常见的文件名或路径，例如 `/flag`、`/etc/passwd`、`/static/../app.py`。 |
| **利用模板/文件引用加载 RCE 载荷** | 结合文件上传漏洞，将包含模板注入（如 SSTI）载荷的 HTML 文件上传到服务器的公共目录，然后利用 `error_type=../images/pwn.html` 这样的参数引用并执行该文件。 |

### 二、 类型二：身份验证/会话数据操纵导致的权限提升

这类攻击利用了应用程序在客户端存储或处理身份验证信息（如 Cookie 或 JWT）时的缺陷，允许攻击者通过修改这些数据来伪造权限。

#### 题目类型 (Topic Categories)

1.  **不安全的反序列化/数据结构操纵**：应用程序将序列化对象（常见于 PHP）存储在 Cookie 中。攻击者通过 Base64 解码、修改序列化字符串中的用户角色、权限标志位（如 `is_admin`、`role`）或密码字段，再重新编码后发送，实现权限提升。
2.  **弱 JSON Web Token (JWT) 认证**：JWT 的签名机制存在缺陷（如使用 `alg: none`），或未对 Payload 中的权限字段（如 `user_type` 或 `user_id`）进行验证，导致攻击者可以伪造任意身份(flag 用户)。
3.  **客户端标志位注入**：应用程序依赖于特定的 Header 或 Cookie 来赋予权限，攻击者通过在请求中注入这些标志位（例如 `X-Admin: 1`、`isAdmin=1`）来绕过授权检查。

#### 做题技巧或手法 (Exploitation Techniques)

| 技巧/手法 | 详细说明 |
| :--- | :--- |
| **PHP 序列化类型混淆** | 利用 PHP 的弱类型比较特性，在反序列化载荷中修改密码字段的数据类型，尝试使用布尔值 `b:1;` 或浮点数 `d:0;` 来绕过密码的严格字符串比较。 |
| **JWT 签名算法降级** | 明确将 JWT Header 中的签名算法（`alg`）设置为 `none`，并修改 Payload 中的关键字段（如将 `user_type` 从 `customer` 改为 `admin` 或将 `user_id` 改为 `0` 或 `1`），然后发送无签名或伪造签名的 Token。 |
| **会话/Header 注入** | 尝试在请求头中注入或修改权限相关的 Header（如 `X-Admin: 1`、`X-Debug: 1`）或 IP 欺骗 Header（如 `X-Forwarded-For: 127.0.0.1`），以模拟来自内部网络或具有管理权限的请求。 |

### 三、 类型三：弱身份验证机制/逻辑缺陷

#### 题目类型 (Topic Categories)

1.  **登录绕过 (Login Bypass)**：由于 SQL 注入 或弱密码猜测导致可以直接以高权限用户身份登录。
2.  **验证码/Token 缺陷 (Captcha/Token Flaws)**：验证码逻辑存在缺陷，允许重放、操纵或暴力破解。
3.  **多步骤逻辑流程缺陷**：在用户注册、配置或数据修改的多步骤流程中，未能对所有输入的字段进行严格验证，允许攻击者注入通常隐藏的权限提升参数。

#### 做题技巧或手法 (Exploitation Techniques)

| 技巧/手法 | 详细说明 |
| :--- | :--- |
| **经典 SQL 绕过** | 在用户名和/或密码字段中注入常见的万能密码，例如 `username=admin' OR '1'='1-- -`。 |
| **客户端逻辑参数注入** | 在注册或表单提交中，尝试通过 POST 请求添加隐藏的或预期只有管理员才能修改的字段，如在注册的第三步尝试注入 `is_premium=on` 字段，以获取付费或特权功能。 |
| **验证码数据突变** | 如果验证码存储在 Cookie 中且经过 Base64 等可逆编码，尝试获取其值，并对数据进行微小修改（如修改最后一个字节 `arr[-1]^=1`），以绕过校验，这通常称为“验证码突变”。 |
| **内部 IP 或 Hostname 欺骗** | 尝试使用 `Host: localhost` 或 `Host: admin.local` 等 Header 访问同一端点，以利用可能基于 Host 检查或内部 IP 限制的访问控制。 |


#### 做题技巧或手法 (Exploitation Techniques)

| 技巧/手法 | 详细说明 |
| :--- | :--- |
| **目录和文件模糊测试 (Fuzzing)** | 使用自动化工具（如 `gobuster`、`feroxbuster` 或 `ffuf`）配合字典，大规模扫描常见的管理路径、隐藏文件（`.env`、`.git`）和旗帜文件路径。 |
| **查询参数探测调试信息** | 在 URL 中添加常见的调试参数（如 `?debug=1`、`?source=1` 或 `?view-source`），尝试触发应用显示内部配置或源代码。在某些特殊应用中，甚至可以探测会话内容（如 `?debug=session`）。 |
| **分析静态资源中的元数据** | 下载网站的静态图片（如 PNG、JPG），并使用 `strings` 工具搜索硬编码的 Flag 格式（如 `FLAG{...}`）或敏感字符串。 |
| **探索特殊目录** | 探测常见的默认暴露目录，例如 `/static/`、`/upload/` 或 `/icons/`，以寻找可能未被正确限制的配置文件或文件上传内容。 |